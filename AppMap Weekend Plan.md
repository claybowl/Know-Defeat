**Title: Implement Dynamic Bot Ranking System with Custom Weights and Develop Functional Bot Controller**

**Problem:**
The project requires the implementation of two key features: a dynamic bot ranking system and a functional bot controller. The ranking system should assign a custom weight and update the score (rank) for each bot with every trade. The bot controller should be able to start and stop bots, fetch portfolio data, and allocate available capital.

**Analysis:**
To achieve these objectives, the focus will be on refining the existing systems for bot ranking and management. The current architecture already includes components related to bot ranking and activation, which need enhancements for dynamic weight handling and real-time updates based on trades. The controller's existing structure should be expanded to dynamically manage bot states and resource allocation.

1. **Dynamic Bot Ranking**:
   - Leverage the existing `ProbabilityEngine` and `BotRanker` classes to incorporate a dynamic weighting mechanism. Each bot should have adjustable weights based on custom criteria (e.g., performance metrics, timeframes).
   - Introduce a scoring function that considers these weights, updating the score or rank with each new trade.
   - Modify data structures to store bot-specific weights and historical performance data.

2. **Functional Bot Controller**:
   - Enhance the `update_rankings` method in `ProbabilityEngine` to include triggers that activate/deactivate bots based on their updated ranks.
   - Ensure the controller can retrieve portfolio data and adjust capital allocation according to the rankings. This involves examining current available funds, building functionalities for allocating capital proportionately to the current rank and performance.

**Proposed Changes:**

1. **`src/utils/probability_engine.py`:**
   - Modify the `_update_optimal_weights` method to allow assignment of custom weights per bot. Introduce logic to retrieve these custom weights from configuration or database records.
   - Update `_calculate_rankings` function to utilize custom weights in the calculation of scores and trigger rank updates dynamically as new trade data becomes available.

2. **`src/bot_ranker.py`:**
   - Include the custom weight parameters within the scoring logic of the `rank_bots` method. Ensure the method dynamically updates bot scores based on the latest trade data and the newly assigned weights.

3. **`user_interface/src/streamlit_app2.py`:** 
   - Enhance the UI functionality to support starting/stopping of individual bots. Utilize the framework's session management to maintain states for each bot, allowing toggling of operations.
   - Extend the control panel to fetch and display portfolio data, reflecting the status and allocated funds for each bot based on the new ranking system.

4. **`database_schema` and tables (`bot_metrics`, etc.):**
   - Update the schema to add fields required for storing custom weights and rank history. Ensure that trade actions trigger updates to these fields, either through triggers, scheduled jobs, or direct transaction responses.

5. **`main application logic`:**
   - Ensure integration between trade execution logs, bot ranking changes, and controller response dynamics. This requires orchestrating the flow between trade data consumption and bot management actions.

By implementing these changes, the system will effectively support dynamic bot ranking by integrating custom weights and the bot controller will dynamically manage the activation states and capital allocation for the trading bots. Once implemented, additional bots and ticker symbols can be added, leveraging the structured framework.

[//]: # (This content was generated by AppMap Navie.)
[//]: # (messageId: 6b3d6382-4ce6-4e42-b363-8eb254060c4b)
[//]: # (threadId: b58cfdc2-52e1-40f5-b0f3-dc472f705b17)
